---
title: "CIND820 -Project Data Preparation"
author: "Kinga M"
date: '2022-06-18'
output: html_document
---

Data files were obtained from the WSIB by the numbers (https://www.wsib.ca/en/bythenumbers).  Three reports were generated, one for each type of claim (No Lost Time, Lost Time, and Fatality) for the years 2011 to 2019.

For each file the following filters were applied on the "Report Builder":
Injury/Illness year --> 2011-2019
Industry Sector --> all except Schedule 2 and Unknown
Age --> all except NA
Gender --> all except NA

The code below reads each file, collapses the "Year" column, combines the files via inner join, checks for NA values and writes the end result.

```{r}
#Read the No Lost Time Claims file
#NLT_data<-read.csv("no_lost_time.csv",stringsAsFactors = T, na.strings = "NA", header = T, col.names = c("Industry", "AgeRange", "Gender", "2011", "2012", "2013", "2014", "2015", "2016","2017" , "2018", "2019"))
NLT_data<-read.csv("no_lost_time.csv",stringsAsFactors = T, na.strings = "NA", header = T, col.names = c("Industry", "AgeRange", "Gender", c(2011:2019)))
head(NLT_data)
```


```{r}
#Read the Lost Time Claims file
LT_data<-read.csv("lost_time.csv",stringsAsFactors = T, na.strings = "NA", header = T, col.names = c("Industry", "AgeRange", "Gender", c(2011:2019)))
head(LT_data)
```


```{r}
#Read the Fatality Claims file
F_data<-read.csv("fatalities.csv",stringsAsFactors = T, na.strings = "NA", header = T, col.names = c("Industry", "AgeRange", "Gender", c(2011:2019)))
head(F_data)
```

Creating a long table for each file --> collapsing the "year" columns (col X2011:X2019) using tidyr package
```{r}
library(tidyr)
NLT_long<- pivot_longer(NLT_data, cols = 4:12, names_to = "Year", values_to = "NLT_Claims")
head(NLT_long)
```


```{r}
LT_long<- pivot_longer(LT_data, cols = 4:12, names_to = "Year", values_to = "LT_Claims")
head(LT_long)
```


```{r}
F_long<-pivot_longer(F_data, cols = 4:12, names_to = "Year", values_to = "F_Claims")
head(F_long)
```

Joining the three files by applying "inner join"
```{r}
dfx <- merge(NLT_long, LT_long,by=c("Industry","AgeRange","Gender", "Year") )
df <- merge(dfx, F_long,by=c("Industry","AgeRange","Gender", "Year") )
str(df)
```
Remove the "X" in front of year labels
```{r}
df$Year <- substring(df$Year, 2)
```

Set Year as factor
```{r}
df$Year<-as.factor(df$Year)
```

```{r}
str(df)
```
Check for NA values
```{r}
sum(is.na(df))
```


Write the resulting file
```{r}
write.csv(df, file = "WSIB_data.csv")

#write file with the NLT and LT claims only - removal of x and changing "Year" to factor was also applied to dfx
write.csv(dfx, file = "WSIB_no_fat.csv")
```

